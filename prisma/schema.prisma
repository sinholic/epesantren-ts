// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum Gender {
  L // Laki-laki
  P // Perempuan
}

enum PaymentType {
  BULAN
  BEBAS
}

enum Agama {
  ISLAM
  KRISTEN
  KATOLIK
  HINDU
  BUDHA
  KONGHUCU
}

enum Pendidikan {
  TIDAK_SEKOLAH // Tidak Sekolah
  SD
  SMP
  SMA
  D3
  S1
  S2
  S3
}

enum TinggalBersama {
  BERSAMA_ORANGTUA // Bersama Orangtua
  BERSAMA_WALI // Bersama Wali
}

enum StatusOrangTua {
  MASIH_HIDUP // Masih Hidup
  MENINGGAL // Meninggal
}

enum PaymentMethod {
  CASH // Tunai
  TRANSFER // Transfer Bank
  E_WALLET // E-Wallet
  OTHER // Lainnya
}

// Models
model UserRole {
  role_id   Int    @id @default(autoincrement())
  role_name String? @db.VarChar(100)
  users     User[]

  @@map("user_roles")
}

model User {
  user_id          Int       @id @default(autoincrement())
  user_email       String?   @db.VarChar(45)
  user_password    String?   @db.VarChar(100)
  user_full_name   String?   @db.VarChar(255)
  user_image       String?   @db.VarChar(255)
  user_description String?   @db.Text
  user_role_role_id Int?
  user_is_deleted  Boolean   @default(false)
  user_input_date  DateTime? @db.Timestamp
  user_last_update DateTime? @default(now()) @updatedAt @db.Timestamp

  role            UserRole? @relation(fields: [user_role_role_id], references: [role_id], onDelete: SetNull, onUpdate: SetNull)
  logs            Log[]
  bulan_payments  Bulan[]
  bebas_payments  BebasPay[]
  kredits         Kredit[]
  debits          Debit[]
  informations    Information[]

  @@map("users")
}

model Log {
  log_id     Int       @id @default(autoincrement())
  log_date   DateTime? @db.Timestamp
  log_action String?   @db.VarChar(45)
  log_module String?   @db.VarChar(45)
  log_info   String?   @db.Text
  user_id    Int?

  user User? @relation(fields: [user_id], references: [user_id], onDelete: SetNull, onUpdate: SetNull)

  @@map("logs")
}

model CiSession {
  id        String   @id @db.VarChar(40)
  ip_address String  @db.VarChar(45)
  timestamp Int      @default(0)
  data      Bytes    @db.ByteA

  @@index([timestamp])
  @@map("ci_sessions")
}

model Class {
  class_id   Int       @id @default(autoincrement())
  class_name String?   @db.VarChar(45)
  students   Student[]

  @@map("class")
}

model Major {
  majors_id        Int       @id @default(autoincrement())
  majors_name      String?   @db.VarChar(100)
  majors_short_name String?  @db.VarChar(45)
  students         Student[]

  @@map("majors")
}

model Student {
  student_id            Int       @id @default(autoincrement())
  student_nis           String?   @db.VarChar(45)
  student_nisn          String?   @db.VarChar(45)
  student_password      String?   @db.VarChar(100)
  student_full_name     String?   @db.VarChar(255)
  student_gender        Gender?
  student_born_place    String?   @db.VarChar(45)
  student_born_date     DateTime? @db.Date
  student_img           String?   @db.VarChar(255)
  student_phone         String?   @db.VarChar(45)
  student_hobby         String?   @db.VarChar(100)
  student_address       String?   @db.Text
  student_name_of_mother String?  @db.VarChar(255)
  student_name_of_father String?  @db.VarChar(255)
  student_parent_phone  String?   @db.VarChar(45)
  class_class_id       Int?
  majors_majors_id     Int?
  student_status       Boolean   @default(true)
  student_input_date   DateTime? @db.Timestamp
  student_last_update  DateTime? @db.Timestamp

  class            Class?    @relation(fields: [class_class_id], references: [class_id], onDelete: SetNull, onUpdate: SetNull)
  major            Major?    @relation(fields: [majors_majors_id], references: [majors_id], onDelete: NoAction, onUpdate: NoAction)
  bebas            Bebas[]
  bulan            Bulan[]
  log_trxs         LogTrx[]
  debits           Debit[]

  @@map("student")
}

model Period {
  period_id     Int       @id @default(autoincrement())
  period_start  Int?
  period_end    Int?
  period_status Boolean   @default(false)
  payments      Payment[]

  @@map("period")
}

model Pos {
  pos_id          Int       @id @default(autoincrement())
  pos_name        String?   @db.VarChar(100)
  pos_description String?   @db.VarChar(100)
  jurnal_id       Int?
  payments        Payment[]
  debits          Debit[]

  @@map("pos")
}

model Payment {
  payment_id        Int         @id @default(autoincrement())
  payment_type      PaymentType?
  period_period_id  Int?
  pos_pos_id        Int?
  payment_input_date DateTime?  @db.Timestamp
  payment_last_update DateTime? @db.Timestamp

  period Period? @relation(fields: [period_period_id], references: [period_id], onDelete: SetNull, onUpdate: SetNull)
  pos    Pos?    @relation(fields: [pos_pos_id], references: [pos_id], onDelete: SetNull, onUpdate: SetNull)
  bebas  Bebas[]
  bulan  Bulan[]

  @@map("payment")
}

model Bebas {
  bebas_id          Int       @id @default(autoincrement())
  student_student_id Int?
  payment_payment_id Int?
  bebas_bill        Decimal?  @db.Decimal(10, 2)
  bebas_total_pay   Decimal?  @default(0) @db.Decimal(10, 2)
  bebas_input_date  DateTime? @db.Timestamp
  bebas_last_update DateTime? @db.Timestamp

  student Student? @relation(fields: [student_student_id], references: [student_id], onDelete: SetNull, onUpdate: SetNull)
  payment Payment? @relation(fields: [payment_payment_id], references: [payment_id], onDelete: SetNull, onUpdate: SetNull)
  bebas_pays BebasPay[]

  @@map("bebas")
}

model Month {
  month_id   Int     @id @default(autoincrement())
  month_name String? @db.VarChar(45)
  bulan      Bulan[]

  @@map("month")
}

model Bulan {
  bulan_id          Int       @id @default(autoincrement())
  student_student_id Int?
  payment_payment_id Int?
  month_month_id    Int?
  bulan_bill        Decimal?  @db.Decimal(10, 2)
  bulan_status      Boolean   @default(false)
  bulan_number_pay  String?   @db.VarChar(100)
  bulan_date_pay    DateTime? @db.Date
  user_user_id      Int?
  bulan_input_date  DateTime? @db.Timestamp
  bulan_last_update DateTime? @db.Timestamp

  student Student? @relation(fields: [student_student_id], references: [student_id], onDelete: SetNull, onUpdate: SetNull)
  payment Payment? @relation(fields: [payment_payment_id], references: [payment_id], onDelete: SetNull, onUpdate: SetNull)
  month   Month?   @relation(fields: [month_month_id], references: [month_id], onDelete: NoAction, onUpdate: NoAction)
  user    User?    @relation(fields: [user_user_id], references: [user_id], onDelete: SetNull, onUpdate: SetNull)
  log_trxs LogTrx[]

  @@map("bulan")
}

model BebasPay {
  bebas_pay_id        Int       @id @default(autoincrement())
  bebas_bebas_id      Int?
  bebas_pay_number    String?   @db.VarChar(100)
  bebas_pay_bill      Decimal?  @db.Decimal(10, 2)
  bebas_pay_desc      String?   @db.VarChar(100)
  user_user_id        Int?
  bebas_pay_input_date DateTime? @db.Date
  bebas_pay_last_update DateTime? @db.Timestamp
  jurnal_id           Int?      @default(0)

  bebas Bebas? @relation(fields: [bebas_bebas_id], references: [bebas_id], onDelete: SetNull, onUpdate: SetNull)
  user  User?  @relation(fields: [user_user_id], references: [user_id], onDelete: SetNull, onUpdate: SetNull)
  log_trxs LogTrx[]

  @@map("bebas_pay")
}

model Setting {
  setting_id        Int       @id @default(autoincrement())
  setting_name      String?   @db.VarChar(255)
  setting_value     String?   @db.Text
  setting_last_update DateTime? @db.Timestamp

  @@map("setting")
}

model Kredit {
  kredit_id        Int       @id @default(autoincrement())
  kredit_date      DateTime? @db.Date
  kredit_desc      String?   @db.VarChar(100)
  kredit_value     Decimal?  @db.Decimal(10, 2)
  user_user_id     Int?
  kredit_input_date DateTime? @db.Timestamp
  kredit_last_update DateTime? @db.Timestamp

  user User? @relation(fields: [user_user_id], references: [user_id], onDelete: SetNull, onUpdate: SetNull)

  @@map("kredit")
}

model Debit {
  debit_id            Int       @id @default(autoincrement())
  debit_date          DateTime? @db.Date
  debit_desc          String?   @db.VarChar(100)
  debit_value         Decimal?  @db.Decimal(10, 2)
  user_user_id        Int?
  debit_input_date    DateTime? @db.Timestamp
  debit_last_update   DateTime? @db.Timestamp
  account_id          Int?
  student_id          Int?
  recipient           String?   @db.VarChar(150)
  pos_id              Int?
  jurnal_id           Int?
  ppdb_nisn           String?   @db.Char(20)
  ppdb_participant_id Int?
  created_by          String?   @db.VarChar(50)

  user              User?            @relation(fields: [user_user_id], references: [user_id], onDelete: SetNull, onUpdate: SetNull)
  student           Student?         @relation(fields: [student_id], references: [student_id], onDelete: SetNull, onUpdate: SetNull)
  pos               Pos?             @relation(fields: [pos_id], references: [pos_id], onDelete: SetNull, onUpdate: SetNull)
  ppdb_participant  PPDBParticipant? @relation(fields: [ppdb_participant_id], references: [id], onDelete: SetNull, onUpdate: SetNull)

  @@map("debit")
}

model Holiday {
  id    Int       @id @default(autoincrement())
  year  Int?
  date  DateTime? @db.Date
  info  String?   @db.VarChar(255)

  @@map("holiday")
}

model Letter {
  letter_id     Int       @id @default(autoincrement())
  letter_number String?   @db.VarChar(100)
  letter_month  Int?
  letter_year   Int?

  @@map("letter")
}

model Information {
  information_id        Int       @id @default(autoincrement())
  information_title    String?   @db.VarChar(100)
  information_desc     String?   @db.Text
  information_img       String?   @db.VarChar(255)
  information_publish   Boolean   @default(false)
  user_user_id          Int?
  information_input_date DateTime? @db.Timestamp
  information_last_update DateTime? @db.Timestamp

  user User? @relation(fields: [user_user_id], references: [user_id], onDelete: SetNull, onUpdate: SetNull)

  @@map("information")
}

model LogTrx {
  log_trx_id            Int       @id @default(autoincrement())
  student_student_id     Int?
  bulan_bulan_id         Int?
  bebas_pay_bebas_pay_id Int?
  log_trx_input_date     DateTime? @db.Timestamp
  log_trx_last_update    DateTime? @db.Timestamp

  student Student?  @relation(fields: [student_student_id], references: [student_id], onDelete: SetNull, onUpdate: SetNull)
  bulan   Bulan?    @relation(fields: [bulan_bulan_id], references: [bulan_id], onDelete: SetNull, onUpdate: SetNull)
  bebas_pay BebasPay? @relation(fields: [bebas_pay_bebas_pay_id], references: [bebas_pay_id], onDelete: SetNull, onUpdate: SetNull)

  @@map("log_trx")
}

model Unit {
  id        Int       @id @default(autoincrement())
  name      String?   @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp
  updated_at DateTime? @default(now()) @updatedAt @db.Timestamp

  @@map("unit")
}

model PPDBParticipant {
  id                    Int            @id @default(autoincrement())
  nisn                  String         @db.VarChar(15)
  password              String         @db.VarChar(255)
  no_pendaftaran        String         @db.VarChar(100)
  tanggal_daftar        DateTime       @db.Date
  period_id             Int
  unit_id               Int
  id_jarak              Int
  asal_sekolah          String         @db.VarChar(255)
  nama_peserta          String         @db.VarChar(50)
  email                 String         @db.VarChar(50)
  nomor_hp              String         @db.VarChar(12)
  jenis_kelamin         Gender
  jumlah_saudara_kandung String        @db.VarChar(2)
  tinggi_badan         String         @db.VarChar(3)
  berat_badan          String         @db.VarChar(3)
  tinggal_bersama       TinggalBersama
  nik                   String         @db.VarChar(16)
  no_kk                String         @db.VarChar(20)
  tempat_lahir         String         @db.VarChar(50)
  tanggal_lahir        DateTime       @db.Date
  agama                Agama
  kebutuhan_khusus     String?        @db.VarChar(50)
  photo                String?        @db.VarChar(100)
  alamat               String         @db.VarChar(50)
  rt                   String         @db.VarChar(3)
  rw                   String         @db.VarChar(3)
  nama_dusun           String         @db.VarChar(50)
  nama_kelurahan       String         @db.VarChar(50)
  nama_kecamatan       String         @db.VarChar(50)
  nama_kabupaten       String         @db.VarChar(50)
  nama_provinsi        String         @db.VarChar(50)
  kode_pos             String         @db.VarChar(5)
  alamat_tinggal       String         @db.VarChar(50)
  rt_tinggal           String         @db.VarChar(3)
  rw_tinggal           String         @db.VarChar(3)
  nama_dusun_tinggal   String         @db.VarChar(50)
  nama_kelurahan_tinggal String       @db.VarChar(50)
  nama_kecamatan_tinggal String       @db.VarChar(50)
  nama_kabupaten_tinggal String       @db.VarChar(50)
  nama_provinsi_tinggal  String       @db.VarChar(50)
  kode_pos_tinggal     String         @db.VarChar(5)
  transportasi         String         @db.VarChar(50)
  nama_ayah            String         @db.VarChar(50)
  tahun_lahir_ayah    Int?
  pendidikan_ayah      Pendidikan
  pekerjaan_ayah       String         @db.VarChar(50)
  penghasilan_ayah     String         @db.VarChar(50)
  nama_ibu             String         @db.VarChar(50)
  tahun_lahir_ibu     Int?
  pendidikan_ibu       Pendidikan
  pekerjaan_ibu        String         @db.VarChar(50)
  penghasilan_ibu      String         @db.VarChar(50)
  nama_wali            String?        @db.VarChar(50)
  tahun_lahir_wali     Int?
  pendidikan_wali      Pendidikan?
  pekerjaan_wali       String?       @db.VarChar(50)
  penghasilan_wali     String?       @db.VarChar(50)
  hubungan_wali        String?       @db.VarChar(50)
  created_at           DateTime?     @default(now()) @db.Timestamp
  updated_at           DateTime?     @default(now()) @updatedAt @db.Timestamp

  debits      Debit[]
  ppdb_bayars PPDBBayar[]

  @@index([nisn])
  @@map("ppdb_participant")
}

model PPDBBayar {
  id                Int            @id @default(autoincrement())
  nisn              String?        @db.VarChar(15)
  ppdb_participant_id Int?
  payment_id        Int?
  amount            Decimal?        @db.Decimal(10, 2)
  payment_date      DateTime?       @db.Date
  payment_method    PaymentMethod?
  created_at        DateTime?      @default(now()) @db.Timestamp
  updated_at        DateTime?      @default(now()) @updatedAt @db.Timestamp

  ppdb_participant PPDBParticipant? @relation(fields: [ppdb_participant_id], references: [id], onDelete: SetNull, onUpdate: SetNull)

  @@index([nisn])
  @@index([ppdb_participant_id])
  @@map("ppdb_bayar")
}

model Jurnal {
  jurnal_id   Int       @id @default(autoincrement())
  jurnal_name String?   @db.VarChar(100)
  jurnal_desc String?   @db.Text
  created_at  DateTime? @default(now()) @db.Timestamp
  updated_at  DateTime? @default(now()) @updatedAt @db.Timestamp

  @@map("jurnal")
}
